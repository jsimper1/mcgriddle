#if UNITY_EDITOR
using UnityEditor;
using UnityEditor.SceneManagement;

using System;
using UnityEngine;
using System.Collections.Generic;
using UnityEngine.SceneManagement;

namespace Mona
{
    public static class MonaErrorCodes
    { 
        // Artifact errors
        public static string BAD_ARTIFACT_PLACEMENT = "artifact.bad-artifact-placement";
        public static string BAD_ARTIFACT_TAG = "artifact.bad-artifact-tag";
        public static string BAD_ARTIFACT_NAME = "artifact.bad-artifact-name";
        public static string BAD_ARTIFACT_COLLIDER = "artifact.bad-artifact-collider";

        // Canvas errors
        public static string BAD_CANVAS_PLACEMENT = "canvas.bad-canvas-placement";
        public static string BAD_CANVAS_NAME = "canvas.bad-canvas-name";

        // Portal errors
        public static string BAD_PORTAL_PLACEMENT = "portal.bad-portal-placement";
        public static string BAD_PORTAL_TAG = "portal.bad-portal-tag";
        public static string BAD_PORTAL_COLLIDER = "portal.bad-portal-collider";
        public static string BAD_PORTAL_NAME = "portal.bad-portal-name";

        // Scene errors
        public static string MISSING_LAYER = "scene.missing-layer";
        public static string BAD_LAYER_TAG = "scene.bad-layer-tag";
        
    }

    // Quailty Checks that run both in editor and in private-build
    public static partial class QualityAssurance
    {

        // Is a list of error codes generated by the space.
        public static List<string[]> SpaceErrors;
        private static List<int> s_iconRegisters;

        private static Scene s_spaceScene, s_artifactsScene, s_portalsScene;

        // Run QA check
        public static void CheckQuality()
        {
            // Add a test error
            SpaceErrors = new List<string[]>();

            if (s_iconRegisters == null)
            {
                s_iconRegisters = new List<int>();
            }
            else
            {
                // Remove all registered icons
                foreach (int i in s_iconRegisters)
                {
                    TreeIcon.UnregisterHierarchyItem(i);
                }
            }

#if UNITY_EDITOR
            s_spaceScene = EditorSceneManager.GetSceneByName("Space");
            s_artifactsScene = EditorSceneManager.GetSceneByName("Artifacts");
            s_portalsScene = EditorSceneManager.GetSceneByName("Portals");

            // Force all scenes to be loaded
            if (!s_spaceScene.isLoaded)
            {
                EditorSceneManager.OpenScene("Assets/Scenes/Space.unity", OpenSceneMode.Additive);
            }

            if (!s_artifactsScene.isLoaded)
            {
                EditorSceneManager.OpenScene("Assets/Scenes/Artifacts.unity", OpenSceneMode.Additive);
            }

            if (!s_portalsScene.isLoaded)
            {
                EditorSceneManager.OpenScene("Assets/Scenes/Portals.unity", OpenSceneMode.Additive);
            }
#else
            // Runtime loaded scenes
            s_spaceScene = SceneManager.GetSceneByName("Space");
            s_artifactsScene = SceneManager.GetSceneByName("Artifacts");
            s_portalsScene = SceneManager.GetSceneByName("Portals");
#endif

            // Scene tests
            TestSceneExistance();
            TestLayerTags();

            // Portal tests
            TestPortalPlacments();
            TestPortalTag();
            TestPortalCollider();
            TestPortalNames();

            // Artifacts tests
            TestArtifactPlacments();
            TestArtifactTag();
            TestArtifactCollider();
            TestArtifactNames();

            // Canvas tests
            TestCanvasPlacments();
            TestCanvasNames();

        }
    }
}
#endif